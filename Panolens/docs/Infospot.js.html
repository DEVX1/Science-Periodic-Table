<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: infospot/Infospot.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: infospot/Infospot.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>( function () {

	/**
	 * Information spot attached to panorama
	 * @constructor
	 * @param {number} [scale=1] - Infospot scale
	 * @param {imageSrc} [imageSrc=PANOLENS.DataImage.Info] - Image overlay info
	 * @param {HTMLElement} [container=document.body] - The dom element contains infospot elements
	 */
	PANOLENS.Infospot = function ( scale, imageSrc, container ) {
		
		var scope = this, ratio;

		THREE.Sprite.call( this );

		this.type = 'infospot';

		this.isHovering = false;
		this.element;
		this.toPanorama;

		this.container = container || document.body;

		// Default is not visible until panorama is loaded
		this.visible = false;

		scale = scale || 1;
		imageSrc = imageSrc || PANOLENS.DataImage.Info;

		this.scale.set( scale, scale, 1 );

		PANOLENS.Utils.TextureLoader.load( imageSrc, postLoad );		

		function postLoad ( texture ) {

			texture.minFilter = texture.maxFilter = THREE.LinearFilter;

			texture.wrapS = THREE.RepeatWrapping;

			texture.repeat.x = -1;

			scope.material.map = texture;
			scope.material.depthWrite = false;
			scope.material.depthTest = false;

			ratio = texture.image.width / texture.image.height;

			scope.scale.set( ratio * scale, scale, 1 );

			scope.hoverStartScale = scope.scale.clone();
			scope.hoverEndScale = scope.scale.clone().multiplyScalar( 1.3 );
			scope.hoverEndScale.z = 1;

			scope.scaleUpAnimation = new TWEEN.Tween( scope.scale )
				.to( { x: scope.hoverEndScale.x, y: scope.hoverEndScale.y }, 500 )
				.easing( TWEEN.Easing.Elastic.Out );

			scope.scaleDownAnimation = new TWEEN.Tween( scope.scale )
				.to( { x: scope.hoverStartScale.x, y: scope.hoverStartScale.y }, 500 )
				.easing( TWEEN.Easing.Elastic.Out );

			scope.showAnimation = new TWEEN.Tween( scope.material )
				.to( { opacity: 1 }, scope.animationDuration )
				.onStart( function () { scope.visible = true; } )
				.easing( TWEEN.Easing.Quartic.Out );

			scope.hideAnimation = new TWEEN.Tween( scope.material )
				.to( { opacity: 0 }, scope.animationDuration )
				.onComplete( function () { scope.visible = false; } )
				.easing( TWEEN.Easing.Quartic.Out );

		}

		// Lock element if there's one
		this.addEventListener( 'click', function () {

			this.element &amp;&amp; this.lockHoverElement();

		} );

	}

	PANOLENS.Infospot.prototype = Object.create( THREE.Sprite.prototype );

	PANOLENS.Infospot.prototype.onHover = function ( x, y ) {

		if ( !this.isHovering ) {

			this.onHoverStart();
			this.isHovering = true;

		}

		if ( !this.element || this.element.locked ) { return; }

		var left, top;

		left = x - this.element.clientWidth / 2;
		top = y - this.element.clientHeight - 30;

		this.element.style.webkitTransform =
		this.element.style.msTransform =
		this.element.style.transform = 'translate(' + left + 'px, ' + top + 'px)';

	};

	PANOLENS.Infospot.prototype.onHoverStart = function() {

		if ( !this.hoverEndScale.equals( this.scale ) ) {

			this.scaleDownAnimation.stop();
			this.scaleUpAnimation.start();

		}

		if ( this.element &amp;&amp; this.element.style.display === 'none' ) {

			this.element.style.display = 'block';

		}

	};

	PANOLENS.Infospot.prototype.onHoverEnd = function() {

		this.isHovering = false;
		
		if ( !this.hoverStartScale.equals( this.scale ) ) {

			this.scaleUpAnimation.stop();
			this.scaleDownAnimation.start();

		}

		if ( this.element &amp;&amp; this.element.style.display !== 'none' ) {

			this.element.style.display = 'none';
			this.unlockHoverElement();

		}

	};

	PANOLENS.Infospot.prototype.setText = function ( text ) {

		if ( this.element ) {

			this.element.textContent = text;

		}

	};

	PANOLENS.Infospot.prototype.addHoverText = function ( text ) {

		if ( !this.element ) {

			this.element = document.createElement( 'div' );

			this.element.style.color = '#fff';
			this.element.style.top = 0;
			this.element.style.maxWidth = '50%';
			this.element.style.maxHeight = '50%';
			this.element.style.textShadow = '0 0 3px #000000';
			this.element.style.fontFamily = '"Trebuchet MS", Helvetica, sans-serif';
			this.element.style.position = 'absolute';
			this.element.style.display = 'none';
			this.element.classList.add( 'panolens-infospot' );

			this.container.appendChild( this.element );

		}

		this.setText( text );

	};

	PANOLENS.Infospot.prototype.addHoverElement = function ( el ) {

		if ( !this.element ) { 

			this.element = el.cloneNode( true );
			this.element.style.top = 0;
			this.element.style.position = 'absolute';
			this.element.style.display = 'none';
			this.element.classList.add( 'panolens-infospot' );

			this.container.appendChild( this.element );

		}

	};

	PANOLENS.Infospot.prototype.removeHoverElement = function () {

		if ( this.element ) { 

			this.container.removeChild( this.element );

			this.element = undefined;

		}

	};

	PANOLENS.Infospot.prototype.lockHoverElement = function () {

		if ( this.element ) { 

			this.element.locked = true;

		}

	};

	PANOLENS.Infospot.prototype.unlockHoverElement = function () {

		if ( this.element ) { 

			this.element.locked = false;

		}

	};

	PANOLENS.Infospot.prototype.show = function ( delay ) {

		delay = delay || 0;

		this.hideAnimation &amp;&amp; this.hideAnimation.stop();
		this.showAnimation &amp;&amp; this.showAnimation.delay( delay ).start();

	};

	PANOLENS.Infospot.prototype.hide = function ( delay ) {

		delay = delay || 0;

		this.showAnimation &amp;&amp; this.showAnimation.stop();
		this.hideAnimation &amp;&amp; this.hideAnimation.delay( delay ).start();
		
	};

} )()</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="PANOLENS.BasicPanorama.html">BasicPanorama</a></li><li><a href="PANOLENS.CubePanorama.html">CubePanorama</a></li><li><a href="PANOLENS.EmptyPanorama.html">EmptyPanorama</a></li><li><a href="PANOLENS.GoogleStreetviewPanorama.html">GoogleStreetviewPanorama</a></li><li><a href="PANOLENS.ImagePanorama.html">ImagePanorama</a></li><li><a href="PANOLENS.Infospot.html">Infospot</a></li><li><a href="PANOLENS.Panorama.html">Panorama</a></li><li><a href="PANOLENS.SpriteText.html">SpriteText</a></li><li><a href="PANOLENS.Tile.html">Tile</a></li><li><a href="PANOLENS.TileGroup.html">TileGroup</a></li><li><a href="PANOLENS.Viewer.html">Viewer</a></li><li><a href="PANOLENS.Widget.html">Widget</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a> on Tue Mar 08 2016 21:05:43 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
